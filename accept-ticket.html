<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accept Ticket - Ticketmaster</title>
    <link href="index.css" rel="stylesheet">
    <style>
        /* Accept Ticket Page Specific Styles */
        .accept-ticket-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 0;
            background: white;
            min-height: 100vh;
        }
        
        .ticket-header {
            background: #0066cc;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .ticket-logo {
            font-size: 24px;
            font-style: italic;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .ticket-title {
            font-size: 18px;
            margin: 0;
            font-weight: normal;
        }
        
        .ticket-content {
            padding: 20px;
        }
        
        .greeting {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
        }
        
        .sender-info {
            font-size: 16px;
            color: #333;
            margin-bottom: 20px;
        }
        
        .event-title {
            font-size: 20px;
            font-weight: bold;
            color: #000;
            margin: 0 0 15px 0;
        }
        
        .event-details {
            margin-bottom: 30px;
        }
        
        .event-detail-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px 0;
        }
        
        .event-detail-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            flex-shrink: 0;
            font-size: 16px;
        }
        
        .event-detail-text {
            flex: 1;
            font-size: 14px;
            color: #333;
        }
        
        .event-detail-label {
            font-weight: bold;
            color: #000;
        }
        
        .seat-details-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
        }
        
        .seat-details-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e9ecef;
            font-size: 14px;
        }
        
        .seat-details-table td:first-child {
            font-weight: bold;
            color: #666;
            width: 30%;
        }
        
        .seat-details-table tr:last-child td {
            border-bottom: none;
        }
        
        .action-buttons {
            text-align: center;
            margin: 30px 0;
        }
        
        .accept-button {
            background: #0066cc;
            color: white;
            padding: 14px 24px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin: 0 8px;
            transition: background-color 0.3s;
            cursor: pointer;
            min-width: 140px;
        }
        
        .accept-button:hover {
            background: #0052a3;
        }
        
        .decline-button {
            background: #6c757d;
            color: white;
            padding: 14px 24px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            text-decoration: none;
            display: inline-block;
            margin: 0 8px;
            transition: background-color 0.3s;
            cursor: pointer;
            min-width: 140px;
        }
        
        .decline-button:hover {
            background: #5a6268;
        }
        
        .footer-text {
            margin-top: 30px;
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        .footer-text p {
            margin: 0 0 15px 0;
        }
        
        .processing-notice {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .notice-icon {
            font-size: 24px;
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .notice-content h4 {
            margin: 0 0 10px 0;
            color: #0369a1;
            font-size: 16px;
        }
        
        .notice-content p {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #0369a1;
            line-height: 1.4;
        }
        
        .notice-content p:last-child {
            margin-bottom: 0;
        }
        
        .warning-text {
            font-weight: bold;
            margin: 30px 0 0 0;
            text-align: center;
            color: #000;
            font-size: 16px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 50px;
            color: #dc3545;
            font-size: 18px;
        }
        
        /* Accept Modal Styles */
        .accept-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }
        
        .accept-modal.open {
            display: flex;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .accept-modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: scale(0.9) translateY(-20px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .accept-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
        }
        
        .accept-modal-header h3 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
            color: #111827;
        }
        
        .close-modal {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            color: #6b7280;
            font-size: 24px;
            line-height: 1;
            transition: all 0.2s ease;
        }
        
        .close-modal:hover {
            background-color: #f3f4f6;
            color: #374151;
        }
        
        .accept-modal-body {
            padding: 24px;
            text-align: center;
        }
        
        .accept-modal-body p {
            margin: 0 0 16px 0;
            font-size: 16px;
            color: #374151;
            line-height: 1.5;
        }
        
        .accept-modal-body p:last-of-type {
            margin-bottom: 24px;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .signin-btn {
            background: #0066cc;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            min-width: 180px;
        }
        
        .signin-btn:hover {
            background: #0052a3;
        }
        
        .back-btn {
            background: #6b7280;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            min-width: 120px;
        }
        
        .back-btn:hover {
            background: #4b5563;
        }
        
        .ticket-timing-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-size: 14px;
            color: #0369a1;
            line-height: 1.5;
        }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .accept-ticket-container {
                margin: 0;
            }
            
            .ticket-header {
                padding: 15px;
            }
            
            .ticket-content {
                padding: 15px;
            }
            
            .action-buttons {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .accept-button, .decline-button {
                margin: 0;
                width: 100%;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
            
            .signin-btn, .back-btn {
                width: 100%;
                min-width: auto;
            }
        }
    </style>
</head>
<body style="font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f5f5;">
    <div class="accept-ticket-container">
        <!-- Loading State -->
        <div id="loading" class="loading">
            Loading ticket details...
        </div>
        
        <!-- Error State -->
        <div id="error" class="error" style="display: none;">
            Error loading ticket details. Please check the URL parameters.
        </div>
        
        <!-- Ticket Details Content -->
        <div id="ticket-content" style="display: none;">
            <!-- Header -->
            <div class="ticket-header">
                <div class="ticket-logo">
                    ticketmaster<span style="font-size: 8px; vertical-align: super;">¬Æ</span>
                </div>
                <h1 class="ticket-title">Accept Ticket Transfer</h1>
            </div>
            
            <!-- Main content area -->
            <div class="ticket-content">
                <!-- Greeting -->
                <p class="greeting">Hi <span id="recipient-name">Loading...</span>,</p>
                
                <p class="sender-info">
                    <strong id="sender-name">Loading...</strong> has sent you <span id="ticket-count">Loading...</span> ticket<span id="ticket-plural">s</span>.
                </p>
                
                <!-- Event Title -->
                <h2 id="event-title" class="event-title">Loading...</h2>
                
                <!-- Event Details with Icons -->
                <div class="event-details">
                    <div class="event-detail-row">
                        <div class="event-detail-icon">üè¢</div>
                        <div class="event-detail-text">
                            <span class="event-detail-label" id="event-venue">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="event-detail-row">
                        <div class="event-detail-icon">üìÖ</div>
                        <div class="event-detail-text">
                            <span class="event-detail-label" id="event-date">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="event-detail-row">
                        <div class="event-detail-icon">üé´</div>
                        <div class="event-detail-text">
                            <span class="event-detail-label" id="ticket-count-display">Loading...</span>
                        </div>
                    </div>
                </div>
                
                <!-- Seat Details Table -->
                <table class="seat-details-table">
                    <tr>
                        <td>Section</td>
                        <td id="section">Loading...</td>
                    </tr>
                    <tr>
                        <td>Row</td>
                        <td id="row">Loading...</td>
                    </tr>
                    <tr>
                        <td>Seat</td>
                        <td id="seats">Loading...</td>
                    </tr>
                    <tr>
                        <td>Type</td>
                        <td id="ticket-type">Loading...</td>
                    </tr>
                </table>
                
                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="accept-button" onclick="acceptTicket()">Accept Ticket(s)</button>
                    <button class="decline-button" onclick="declineTicket()">Decline</button>
                </div>
                
                <!-- Processing Notice -->
                <div class="processing-notice">
                    <div class="notice-icon">‚è∞</div>
                    <div class="notice-content">
                        <h4>Ticket Processing Information</h4>
                        <p><strong>Processing Time:</strong> Your tickets will be processed and logged into the system within 72 hours.</p>
                        <p><strong>Availability:</strong> Tickets will be available in your account 24 hours before the event date.</p>
                    </div>
                </div>
                
                <!-- Footer Text -->
                <div class="footer-text">
                    <p>Accepting tickets sent to you is free. Log in to your Ticketmaster account or create a new account to accept your ticket(s).</p>
                    
                    <p>If you purchased these tickets through an External Resale Platform and the event is unexpectedly canceled, postponed, or significantly changed, you should contact that third party for information about refund options.</p>
                    
                    <p class="warning-text">THIS PAGE DOES NOT GRANT ACCESS TO THE EVENT</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Accept Modal -->
    <div id="accept-modal" class="accept-modal">
        <div class="accept-modal-content">
            <div class="accept-modal-header">
                <h3>‚úÖ Ticket Accepted!</h3>
                <button class="close-modal" onclick="closeAcceptModal()">&times;</button>
            </div>
            <div class="accept-modal-body">
                <p>Your ticket has been successfully accepted!</p>
                <p>To view your tickets, please sign in to your Ticketmaster account or create a new account.</p>
                
                <div class="ticket-timing-info">
                    <strong>üìÖ Important:</strong> Tickets may take up to 72 hours to appear in your account, but will always be available 24 hours before the event.
                </div>
                
                <div class="modal-buttons">
                    <button class="signin-btn" onclick="goToSignIn()">Sign In / Create Account</button>
                    <button class="back-btn" onclick="goBack()">Go Back</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Function to get URL parameters
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // Function to display ticket data from URL parameters
        function displayTicketData() {
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const content = document.getElementById('ticket-content');
            
            try {
                // Get data from URL parameters
                const recipientName = getUrlParameter('recipientName') || 'Guest';
                const senderName = getUrlParameter('senderName') || 'Unknown Sender';
                const eventTitle = getUrlParameter('eventName') || 'Event Title';
                const eventVenue = getUrlParameter('eventDetails') || 'Venue Name';
                const eventDate = getUrlParameter('eventDate') || 'Event Date';
                const eventTime = getUrlParameter('eventTime') || 'Event Time';
                const ticketCount = getUrlParameter('ticketCount') || '1';
                const section = getUrlParameter('section') || 'Section';
                const row = getUrlParameter('row') || 'Row';
                
                // Handle template variables that weren't replaced
                const cleanRow = (row.includes('{{') || row === 'X') ? '5' : row;
                const seats = getUrlParameter('seats') || 'Seats';
                const cleanSeats = (seats.includes('{{') || seats === 'X') ? '9' : seats;
                const ticketType = getUrlParameter('ticketType') || 'General';
                const cleanTicketType = (ticketType.includes('{{') || ticketType === 'X') ? 'Seated' : ticketType;
                
                // Debug logging
                console.log('URL Parameters:', {
                    recipientName, senderName, eventTitle, eventVenue, 
                    eventDate, eventTime, ticketCount, section, row: cleanRow, seats: cleanSeats, ticketType: cleanTicketType
                });
                
                // Check if we have minimum required data
                if (!eventTitle || eventTitle === 'Event Title') {
                    throw new Error('Missing required event data');
                }
                
                // Update the page content
                document.getElementById('recipient-name').textContent = recipientName;
                document.getElementById('sender-name').textContent = senderName;
                document.getElementById('ticket-count').textContent = ticketCount;
                document.getElementById('ticket-count-display').textContent = ticketCount + ' ticket' + (ticketCount > 1 ? 's' : '');
                document.getElementById('ticket-plural').textContent = ticketCount > 1 ? 's' : '';
                document.getElementById('event-title').textContent = eventTitle;
                document.getElementById('event-venue').textContent = eventVenue;
                // Combine date and time properly to avoid duplication
                let fullDateTime;
                
                // Ensure date includes year if missing
                let cleanEventDate = eventDate;
                if (eventDate && !eventDate.includes('2024') && !eventDate.includes('2025') && !eventDate.includes('2026')) {
                    // Add current year if no year is present
                    const currentYear = new Date().getFullYear();
                    cleanEventDate = eventDate + ', ' + currentYear;
                }
                
                if (cleanEventDate.includes(' at ')) {
                    // If date already includes time, use as is
                    fullDateTime = cleanEventDate;
                } else if (eventTime && eventTime !== 'Event Time') {
                    // If we have a separate time, combine them
                    fullDateTime = cleanEventDate + ' at ' + eventTime;
                } else {
                    // Fallback to just the date
                    fullDateTime = cleanEventDate;
                }
                document.getElementById('event-date').textContent = fullDateTime;
                document.getElementById('section').textContent = section;
                document.getElementById('row').textContent = cleanRow;
                document.getElementById('seats').textContent = cleanSeats;
                document.getElementById('ticket-type').textContent = cleanTicketType;
                
                // Update page title
                document.title = `${eventTitle} - Accept Ticket`;
                
                // Hide loading, show content
                loading.style.display = 'none';
                content.style.display = 'block';
                
            } catch (err) {
                console.error('Error loading ticket data:', err);
                loading.style.display = 'none';
                error.style.display = 'block';
            }
        }
        
        // Function to accept ticket
        function acceptTicket() {
            // Get the event date and time (they're combined in event-date)
            const eventDateTime = document.getElementById('event-date').textContent;
            const [eventDate, eventTime] = eventDateTime.split(' at ');
            
            // Store the accepted ticket data in localStorage
            const ticketData = {
                eventName: document.getElementById('event-title').textContent,
                recipientName: document.getElementById('recipient-name').textContent,
                eventDetails: document.getElementById('event-venue').textContent,
                eventDate: eventDate || eventDateTime,
                eventTime: eventTime || '6:00 PM',
                section: document.getElementById('section').textContent,
                row: document.getElementById('row').textContent,
                seats: document.getElementById('seats').textContent,
                ticketType: document.getElementById('ticket-type').textContent,
                acceptedAt: new Date().toISOString(),
                status: 'accepted'
            };
            
            // Store in localStorage
            localStorage.setItem('acceptedTicket', JSON.stringify(ticketData));
            localStorage.setItem('hasAcceptedTicket', 'true');
            
            // Store current URL parameters for later use
            const currentUrl = new URL(window.location.href);
            const urlParams = currentUrl.searchParams.toString();
            if (urlParams) {
                localStorage.setItem('preservedUrlParams', urlParams);
                console.log('Stored URL parameters:', urlParams);
            }
            
            // Show modal after accepting
            const modal = document.getElementById('accept-modal');
            modal.classList.add('open');
            document.body.style.overflow = 'hidden';
        }
        
        // Function to decline ticket
        function declineTicket() {
            if (confirm('Are you sure you want to decline this ticket?')) {
                alert('Ticket declined. The sender will be notified.');
                // Here you can add logic to process the ticket decline
            }
        }
        
        // Function to close accept modal
        function closeAcceptModal() {
            const modal = document.getElementById('accept-modal');
            modal.classList.remove('open');
            document.body.style.overflow = '';
        }
        
        // Function to go to sign in page
        function goToSignIn() {
            closeAcceptModal();
            window.location.href = 'login.html';
        }
        
        // Function to go back
        function goBack() {
            closeAcceptModal();
            window.history.back();
        }
        
        // Close modal when clicking outside
        document.getElementById('accept-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAcceptModal();
            }
        });
        
        // Close modal with escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeAcceptModal();
            }
        });
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', displayTicketData);
    </script>
</body>
</html>
