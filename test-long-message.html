<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Long Custom Message</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-link {
            display: inline-block;
            background: #1976d2;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 4px;
            margin: 10px 5px;
        }
        .test-link:hover {
            background: #1565c0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .url-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            word-break: break-all;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        textarea {
            width: 100%;
            height: 100px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #218838;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Long Custom Message URL Handling</h1>
    
    <div class="test-section">
        <h2>üìù Custom Message Test</h2>
        <p>Enter a custom message to test URL length limits:</p>
        <textarea id="customMessage" placeholder="Enter your custom message here...">Your tickets are ready for transfer and will be activated upon acceptance. Please ensure you have the Ticketmaster app installed on your mobile device. You will receive a notification 24 hours before the event with instructions on how to access your tickets. If you have any questions, please contact our support team at support@ticketmaster.com or call 1-800-653-8000. Thank you for choosing Ticketmaster!</textarea>
        <br>
        <button onclick="generateTestUrl()">Generate Test URL</button>
        <button onclick="testCurrentUrl()">Test Current URL</button>
    </div>

    <div class="test-section">
        <h2>üîó Generated URLs</h2>
        <div id="urlResults"></div>
    </div>

    <div class="test-section">
        <h2>üìä URL Analysis</h2>
        <div id="urlAnalysis"></div>
    </div>

    <div class="test-section">
        <h2>üß™ Pre-made Test Cases</h2>
        <a href="#" class="test-link" onclick="testShortMessage()">Short Message</a>
        <a href="#" class="test-link" onclick="testMediumMessage()">Medium Message</a>
        <a href="#" class="test-link" onclick="testLongMessage()">Long Message</a>
        <a href="#" class="test-link" onclick="testVeryLongMessage()">Very Long Message</a>
    </div>

    <script>
        function generateTestUrl() {
            const customMessage = document.getElementById('customMessage').value;
            const baseUrl = 'index.html';
            
            const params = new URLSearchParams({
                recipientName: 'John Doe',
                senderName: 'Jane Smith',
                eventName: 'Test Event',
                eventDetails: 'Test Venue',
                eventDate: 'Mon, Dec 15, 2025, 1:00 PM',
                eventTime: '1:00 PM',
                ticketCount: '2',
                section: 'A',
                row: '1',
                seats: '1,2',
                ticketType: 'Seated',
                customMessage: customMessage
            });
            
            const fullUrl = `${baseUrl}?${params.toString()}`;
            
            document.getElementById('urlResults').innerHTML = `
                <h3>Generated URL:</h3>
                <div class="url-display">${fullUrl}</div>
                <a href="${fullUrl}" class="test-link" target="_blank">Test This URL</a>
            `;
            
            analyzeUrl(fullUrl, customMessage);
        }
        
        function analyzeUrl(url, originalMessage) {
            const urlLength = url.length;
            const maxUrlLength = 2048; // Common browser limit
            const isOverLimit = urlLength > maxUrlLength;
            
            // Check if custom message is preserved
            const urlParams = new URLSearchParams(url.split('?')[1] || '');
            const retrievedMessage = urlParams.get('customMessage') || '';
            const messagePreserved = retrievedMessage === originalMessage;
            
            let statusClass = 'success';
            let statusText = '‚úÖ URL is within limits and message is preserved';
            
            if (!messagePreserved) {
                statusClass = 'error';
                statusText = '‚ùå Custom message was truncated or lost';
            } else if (isOverLimit) {
                statusClass = 'warning';
                statusText = '‚ö†Ô∏è URL exceeds recommended length but message is preserved';
            }
            
            document.getElementById('urlAnalysis').innerHTML = `
                <div class="status ${statusClass}">
                    <strong>Status:</strong> ${statusText}
                </div>
                <div class="status info">
                    <strong>URL Length:</strong> ${urlLength} characters (limit: ${maxUrlLength})
                </div>
                <div class="status info">
                    <strong>Original Message Length:</strong> ${originalMessage.length} characters
                </div>
                <div class="status info">
                    <strong>Retrieved Message Length:</strong> ${retrievedMessage.length} characters
                </div>
                <div class="status info">
                    <strong>Message Match:</strong> ${messagePreserved ? 'Yes' : 'No'}
                </div>
            `;
        }
        
        function testCurrentUrl() {
            const currentUrl = window.location.href;
            const urlParams = new URLSearchParams(window.location.search);
            const customMessage = urlParams.get('customMessage') || '';
            
            if (customMessage) {
                analyzeUrl(currentUrl, customMessage);
            } else {
                document.getElementById('urlAnalysis').innerHTML = `
                    <div class="status warning">
                        No custom message found in current URL
                    </div>
                `;
            }
        }
        
        function testShortMessage() {
            document.getElementById('customMessage').value = 'Short message';
            generateTestUrl();
        }
        
        function testMediumMessage() {
            document.getElementById('customMessage').value = 'This is a medium length custom message that should test the URL handling capabilities. It contains enough text to potentially cause issues with URL length limits.';
            generateTestUrl();
        }
        
        function testLongMessage() {
            document.getElementById('customMessage').value = 'This is a very long custom message that will definitely test the URL length limits. It contains a lot of text that should be properly encoded and preserved in the URL parameters. This message is designed to push the boundaries of what can be handled by standard URL parameter processing. It includes special characters, punctuation, and enough content to potentially exceed browser URL length limits. The message should be preserved even if the URL becomes quite long, and the application should handle this gracefully.';
            generateTestUrl();
        }
        
        function testVeryLongMessage() {
            document.getElementById('customMessage').value = 'This is an extremely long custom message that will definitely exceed URL length limits in most browsers. It contains a massive amount of text that should be properly encoded and preserved in the URL parameters. This message is designed to push the boundaries of what can be handled by standard URL parameter processing. It includes special characters, punctuation, and enough content to definitely exceed browser URL length limits. The message should be preserved even if the URL becomes quite long, and the application should handle this gracefully. This is a test of the URL parameter handling system to ensure that long custom messages are properly preserved and displayed to users. The system should be able to handle messages of any length without losing information or causing errors. This includes proper URL encoding, parameter preservation, and graceful handling of edge cases. The application should provide a good user experience even when dealing with very long custom messages that might cause issues with standard URL handling.';
            generateTestUrl();
        }
        
        // Test current URL on page load
        document.addEventListener('DOMContentLoaded', function() {
            testCurrentUrl();
        });
    </script>
</body>
</html>
