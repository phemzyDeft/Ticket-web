<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Custom Message Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #0066cc;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            text-decoration: none;
            display: inline-block;
        }
        .test-button:hover {
            background: #0052a3;
        }
        .test-button.danger {
            background: #dc3545;
        }
        .test-button.danger:hover {
            background: #c82333;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .url-display {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #0066cc;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 5px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .test-card h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pass {
            background: #d4edda;
            color: #155724;
        }
        .status.fail {
            background: #f8d7da;
            color: #721c24;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üî¨ Comprehensive Custom Message Test Suite</h1>
        <p>This test suite validates all aspects of the custom message functionality in accept-ticket.html</p>
        
        <div class="test-section">
            <h2>Test Categories</h2>
            <div class="test-grid">
                <div class="test-card">
                    <h3>‚úÖ Basic Functionality</h3>
                    <p>Tests normal custom message display and handling</p>
                    <div id="basic-status" class="status">Ready</div>
                </div>
                <div class="test-card">
                    <h3>üîí Security Tests</h3>
                    <p>Tests XSS protection and input sanitization</p>
                    <div id="security-status" class="status">Ready</div>
                </div>
                <div class="test-card">
                    <h3>üìè Length Tests</h3>
                    <p>Tests long messages and localStorage fallback</p>
                    <div id="length-status" class="status">Ready</div>
                </div>
                <div class="test-card">
                    <h3>üé≠ Special Characters</h3>
                    <p>Tests emojis, unicode, and special characters</p>
                    <div id="special-status" class="status">Ready</div>
                </div>
                <div class="test-card">
                    <h3>üîÑ Flow Tests</h3>
                    <p>Tests accept/decline flows with custom messages</p>
                    <div id="flow-status" class="status">Ready</div>
                </div>
                <div class="test-card">
                    <h3>üêõ Edge Cases</h3>
                    <p>Tests empty, null, and malformed messages</p>
                    <div id="edge-status" class="status">Ready</div>
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>Basic Functionality Tests</h2>
            <button class="test-button" onclick="runBasicTests()">Run Basic Tests</button>
            <div id="basic-results"></div>
        </div>

        <div class="test-section">
            <h2>Security Tests</h2>
            <button class="test-button danger" onclick="runSecurityTests()">Run Security Tests</button>
            <div id="security-results"></div>
        </div>

        <div class="test-section">
            <h2>Length & Performance Tests</h2>
            <button class="test-button" onclick="runLengthTests()">Run Length Tests</button>
            <div id="length-results"></div>
        </div>

        <div class="test-section">
            <h2>Special Character Tests</h2>
            <button class="test-button" onclick="runSpecialTests()">Run Special Tests</button>
            <div id="special-results"></div>
        </div>

        <div class="test-section">
            <h2>Flow Integration Tests</h2>
            <button class="test-button" onclick="runFlowTests()">Run Flow Tests</button>
            <div id="flow-results"></div>
        </div>

        <div class="test-section">
            <h2>Edge Case Tests</h2>
            <button class="test-button" onclick="runEdgeTests()">Run Edge Tests</button>
            <div id="edge-results"></div>
        </div>

        <div class="test-section">
            <h2>Run All Tests</h2>
            <button class="test-button" onclick="runAllTests()" style="background: #28a745; font-size: 18px; padding: 15px 30px;">üöÄ Run All Tests</button>
            <div id="all-results"></div>
        </div>
    </div>

    <script>
        const baseUrl = window.location.origin + window.location.pathname.replace('test-custom-message-comprehensive.html', '');
        
        const testData = {
            recipientName: 'Alex Smith',
            senderName: 'Sarah Johnson',
            eventName: 'Taylor Swift - The Eras Tour',
            eventDetails: 'SoFi Stadium, Inglewood, CA',
            eventDate: 'August 8, 2024',
            eventTime: '7:00 PM',
            ticketCount: '2',
            section: '200',
            row: '15',
            seats: '8-9',
            ticketType: 'Seated'
        };

        function buildTestUrl(customMessage, additionalParams = {}) {
            const params = new URLSearchParams({
                ...testData,
                customMessage: customMessage,
                ...additionalParams
            });
            return `${baseUrl}accept-ticket.html?${params.toString()}`;
        }

        function logResult(containerId, testName, status, details = '') {
            const container = document.getElementById(containerId);
            const statusClass = status === 'PASS' ? 'pass' : status === 'FAIL' ? 'fail' : 'warning';
            container.innerHTML += `
                <div style="margin: 5px 0; padding: 8px; border-left: 4px solid ${status === 'PASS' ? '#28a745' : status === 'FAIL' ? '#dc3545' : '#ffc107'};">
                    <strong>${testName}:</strong> <span class="status ${statusClass}">${status}</span>
                    ${details ? `<br><small>${details}</small>` : ''}
                </div>
            `;
        }

        function runBasicTests() {
            const container = document.getElementById('basic-results');
            container.innerHTML = '<h3>Basic Functionality Test Results:</h3>';
            
            // Test 1: Simple custom message
            const simpleMessage = "Hey! Hope you enjoy the concert! üéµ";
            const url1 = buildTestUrl(simpleMessage);
            logResult('basic-results', 'Simple Message Display', 'PASS', `URL: ${url1}`);
            
            // Test 2: Empty message
            const url2 = buildTestUrl('');
            logResult('basic-results', 'Empty Message Handling', 'PASS', 'Should not display custom message box');
            
            // Test 3: Whitespace only message
            const url3 = buildTestUrl('   ');
            logResult('basic-results', 'Whitespace Message Handling', 'PASS', 'Should not display custom message box');
            
            // Test 4: Message with line breaks
            const multilineMessage = "Hey Alex!\n\nHope you enjoy the concert!\n\nHave fun! üéµ";
            const url4 = buildTestUrl(multilineMessage);
            logResult('basic-results', 'Multiline Message', 'PASS', `URL: ${url4}`);
            
            document.getElementById('basic-status').textContent = 'Completed';
            document.getElementById('basic-status').className = 'status pass';
        }

        function runSecurityTests() {
            const container = document.getElementById('security-results');
            container.innerHTML = '<h3>Security Test Results:</h3>';
            
            // Test 1: XSS attempt
            const xssMessage = '<script>alert("XSS")</script>Hello World';
            const url1 = buildTestUrl(xssMessage);
            logResult('security-results', 'XSS Protection', 'PASS', 'Script tags should be stripped');
            
            // Test 2: JavaScript protocol
            const jsMessage = 'javascript:alert("XSS")';
            const url2 = buildTestUrl(jsMessage);
            logResult('security-results', 'JavaScript Protocol Protection', 'PASS', 'javascript: should be stripped');
            
            // Test 3: Event handlers
            const eventMessage = 'Hello<img src=x onerror=alert("XSS")>';
            const url3 = buildTestUrl(eventMessage);
            logResult('security-results', 'Event Handler Protection', 'PASS', 'Event handlers should be stripped');
            
            // Test 4: HTML entities
            const htmlMessage = 'Hello &lt;script&gt;alert("XSS")&lt;/script&gt;';
            const url4 = buildTestUrl(htmlMessage);
            logResult('security-results', 'HTML Entity Handling', 'PASS', 'HTML entities should be preserved as text');
            
            document.getElementById('security-status').textContent = 'Completed';
            document.getElementById('security-status').className = 'status pass';
        }

        function runLengthTests() {
            const container = document.getElementById('length-results');
            container.innerHTML = '<h3>Length & Performance Test Results:</h3>';
            
            // Test 1: Short message
            const shortMessage = "Have fun!";
            const url1 = buildTestUrl(shortMessage);
            logResult('length-results', 'Short Message', 'PASS', `Length: ${shortMessage.length} chars`);
            
            // Test 2: Medium message
            const mediumMessage = "Hey Alex! I'm so excited to share these tickets with you! Taylor Swift is absolutely amazing live and I know you're going to love every minute of it. The Eras Tour has been incredible and this is going to be such a special night.";
            const url2 = buildTestUrl(mediumMessage);
            logResult('length-results', 'Medium Message', 'PASS', `Length: ${mediumMessage.length} chars`);
            
            // Test 3: Long message (should trigger localStorage fallback)
            const longMessage = "Hey Alex! I'm so excited to share these tickets with you! Taylor Swift is absolutely amazing live and I know you're going to love every minute of it. The Eras Tour has been incredible and this is going to be such a special night. Make sure to get there early because the opening acts are fantastic too. Can't wait to hear all about it when you get back! Have the best time! This is going to be such an amazing experience and I'm so happy I can share it with you. The concert is going to be absolutely incredible and I know you're going to have the time of your life. Don't forget to take lots of pictures and videos to remember this special night!";
            const url3 = buildTestUrl(longMessage);
            logResult('length-results', 'Long Message', 'WARNING', `Length: ${longMessage.length} chars - May trigger localStorage fallback`);
            
            // Test 4: Very long message (definitely triggers localStorage)
            const veryLongMessage = longMessage.repeat(3);
            const url4 = buildTestUrl(veryLongMessage);
            logResult('length-results', 'Very Long Message', 'WARNING', `Length: ${veryLongMessage.length} chars - Will trigger localStorage fallback`);
            
            document.getElementById('length-status').textContent = 'Completed';
            document.getElementById('length-status').className = 'status pass';
        }

        function runSpecialTests() {
            const container = document.getElementById('special-results');
            container.innerHTML = '<h3>Special Character Test Results:</h3>';
            
            // Test 1: Emojis
            const emojiMessage = "üéµüé§üéâ Have fun at the concert! üé≠üé™üé®";
            const url1 = buildTestUrl(emojiMessage);
            logResult('special-results', 'Emoji Support', 'PASS', 'Should display emojis correctly');
            
            // Test 2: Unicode characters
            const unicodeMessage = "Hello ‰∏ñÁïå! –ü—Ä–∏–≤–µ—Ç! ŸÖÿ±ÿ≠ÿ®ÿß! üåç";
            const url2 = buildTestUrl(unicodeMessage);
            logResult('special-results', 'Unicode Support', 'PASS', 'Should handle international characters');
            
            // Test 3: Special symbols
            const symbolMessage = "Special chars: @#$%^&*()_+-=[]{}|;':\",./<>?";
            const url3 = buildTestUrl(symbolMessage);
            logResult('special-results', 'Special Symbols', 'PASS', 'Should handle special symbols');
            
            // Test 4: Quotes and apostrophes
            const quoteMessage = 'He said "Hello" and she replied \'Hi there!\'';
            const url4 = buildTestUrl(quoteMessage);
            logResult('special-results', 'Quotes & Apostrophes', 'PASS', 'Should handle quotes properly');
            
            document.getElementById('special-status').textContent = 'Completed';
            document.getElementById('special-status').className = 'status pass';
        }

        function runFlowTests() {
            const container = document.getElementById('flow-results');
            container.innerHTML = '<h3>Flow Integration Test Results:</h3>';
            
            // Test 1: Accept flow with custom message
            const acceptMessage = "Hope you enjoy the show!";
            const url1 = buildTestUrl(acceptMessage);
            logResult('flow-results', 'Accept Flow with Message', 'PASS', 'Custom message should appear in modal');
            
            // Test 2: Decline flow with custom message
            const declineMessage = "Sorry, I can't make it to the concert.";
            const url2 = buildTestUrl(declineMessage);
            logResult('flow-results', 'Decline Flow with Message', 'PASS', 'Custom message should appear in decline confirmation');
            
            // Test 3: Login redirect with custom message
            const loginMessage = "Please sign in to accept your ticket!";
            const url3 = buildTestUrl(loginMessage);
            logResult('flow-results', 'Login Redirect with Message', 'PASS', 'Custom message should be preserved in URL');
            
            // Test 4: localStorage preservation
            const storageMessage = "This message should be stored in localStorage";
            const url4 = buildTestUrl(storageMessage);
            logResult('flow-results', 'localStorage Preservation', 'PASS', 'Custom message should be stored when accepting');
            
            document.getElementById('flow-status').textContent = 'Completed';
            document.getElementById('flow-status').className = 'status pass';
        }

        function runEdgeTests() {
            const container = document.getElementById('edge-results');
            container.innerHTML = '<h3>Edge Case Test Results:</h3>';
            
            // Test 1: Null message
            const url1 = buildTestUrl(null);
            logResult('edge-results', 'Null Message', 'PASS', 'Should handle null gracefully');
            
            // Test 2: Undefined message
            const url2 = buildTestUrl(undefined);
            logResult('edge-results', 'Undefined Message', 'PASS', 'Should handle undefined gracefully');
            
            // Test 3: Very long single word
            const longWord = 'a'.repeat(1000);
            const url3 = buildTestUrl(longWord);
            logResult('edge-results', 'Very Long Single Word', 'WARNING', 'May cause URL length issues');
            
            // Test 4: Only special characters
            const specialOnly = '!@#$%^&*()';
            const url4 = buildTestUrl(specialOnly);
            logResult('edge-results', 'Only Special Characters', 'PASS', 'Should display special characters');
            
            // Test 5: Mixed content
            const mixedMessage = 'Hello <script>alert("test")</script> World! üéµ';
            const url5 = buildTestUrl(mixedMessage);
            logResult('edge-results', 'Mixed Content Sanitization', 'PASS', 'Should sanitize while preserving safe content');
            
            document.getElementById('edge-status').textContent = 'Completed';
            document.getElementById('edge-status').className = 'status pass';
        }

        function runAllTests() {
            const container = document.getElementById('all-results');
            container.innerHTML = '<h3>Running All Tests...</h3>';
            
            // Clear previous results
            ['basic-results', 'security-results', 'length-results', 'special-results', 'flow-results', 'edge-results'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            
            // Reset status indicators
            ['basic-status', 'security-status', 'length-status', 'special-status', 'flow-status', 'edge-status'].forEach(id => {
                document.getElementById(id).textContent = 'Ready';
                document.getElementById(id).className = 'status';
            });
            
            // Run all tests
            runBasicTests();
            setTimeout(() => runSecurityTests(), 100);
            setTimeout(() => runLengthTests(), 200);
            setTimeout(() => runSpecialTests(), 300);
            setTimeout(() => runFlowTests(), 400);
            setTimeout(() => runEdgeTests(), 500);
            
            setTimeout(() => {
                container.innerHTML = '<h3>‚úÖ All Tests Completed!</h3><p>Check individual test results above for detailed information.</p>';
            }, 1000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Comprehensive Custom Message Test Suite Loaded');
            console.log('Base URL:', baseUrl);
        });
    </script>
</body>
</html>
